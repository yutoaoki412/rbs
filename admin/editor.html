<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>記事エディター - RBS陸上教室</title>
  <link rel="stylesheet" href="../css/admin-style.css">
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <div class="logo">RBS陸上教室</div>
        <div class="breadcrumb">管理画面 > 記事エディター</div>
      </div>
      <div class="header-actions">
        <div class="save-status" id="save-status">未保存</div> <!-- This will be managed by AdminEditor -->
        <!-- Replaced onclick with IDs for AdminEditor event listeners -->
        <button class="btn btn-warning" id="saveDraftBtn">
          💾 下書き保存
        </button>
        <button class="btn btn-success" id="publishBtn">
          📤 公開
        </button>
        <!-- backBtn ID is used by AdminEditor for navigation check -->
        <a href="index.html" class="btn btn-secondary" id="backBtn">
          ← 戻る
        </a>
      </div>
    </div>
  </header>

  <div class="container">
    <div class="sidebar">
      <div class="sidebar-section">
        <!-- pageTitle ID might be used by AdminEditor if it exists -->
        <h3 class="sidebar-title" id="pageTitle">記事情報</h3> 
        
        <div class="form-group">
          <label class="form-label" for="article-title">タイトル</label>
          <!-- Changed ID to 'title' to match AdminEditor expectations, but 'article-title' is used in AdminEditor's getFormData -->
          <input type="text" id="article-title" class="form-input" placeholder="記事のタイトルを入力">
        </div>

        <div class="form-group">
          <label class="form-label" for="article-date">公開日</label>
          <!-- Changed ID to 'date' -->
          <input type="date" id="article-date" class="form-input">
        </div>

        <div class="form-group">
          <label class="form-label" for="article-category">カテゴリー</label>
          <!-- Changed ID to 'category' -->
          <select id="article-category" class="form-select">
            <option value="announcement">お知らせ</option>
            <option value="trial">体験会</option>
            <option value="media">メディア</option>
            <option value="important">重要</option>
          </select>
        </div>
        <!-- Optional categoryName field, AdminEditor can handle its absence -->
        <!-- <div class="form-group">
          <label class="form-label" for="categoryName">カテゴリー名（自動生成）</label>
          <input type="text" id="categoryName" class="form-input" readonly>
        </div> -->

        <div class="form-group">
          <label class="form-label" for="article-excerpt">抜粋</label>
          <!-- Changed ID to 'excerpt' -->
          <textarea id="article-excerpt" class="form-textarea" placeholder="記事の概要を入力（150文字程度）"></textarea>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <!-- Changed ID to 'featured' -->
            <input type="checkbox" id="article-featured">
            <label class="form-label" for="article-featured">注目記事にする</label>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">ステータス</label>
          <!-- These elements are updated by the inline script's updateStatusDisplay. -->
          <!-- AdminEditor might need its own way or these need to be standardized if AdminEditor takes over display. -->
          <div class="status-indicator" id="status-indicator">
            <span id="status-text">下書き</span>
          </div>
        </div>
      </div>

      <div class="sidebar-section">
        <h3 class="sidebar-title">Markdownヘルプ</h3>
        <!-- Markdown Toolbar (optional, AdminEditor can initialize this if #markdownToolbar exists) -->
        <!-- <div id="markdownToolbar"></div> -->
        <div class="markdown-help">
          <h4>基本的な記法</h4>
          <p><code># 見出し1</code></p>
          <p><code>## 見出し2</code></p>
          <p><code>**太字**</code></p>
          <p><code>*斜体*</code></p>
          <p><code>[リンク](URL)</code></p>
          <p><code>- リスト項目</code></p>
          <p><code>> 引用</code></p>
          <p><code>`コード`</code></p>
        </div>
      </div>
    </div>

    <div class="main-content">
      <div class="editor-tabs">
        <!-- Removed onclick, tab switching needs to be handled by AdminEditor or a separate utility script if not already -->
        <button class="tab-button active" id="editorTabBtn"> 
          📝 編集
        </button>
        <button class="tab-button" id="previewTabBtn">
          👁️ プレビュー
        </button>
      </div>

      <div class="editor-container">
        <div class="editor-pane active" id="editor-pane">
          <!-- Changed ID to 'content' for AdminEditor, markdown-editor is also checked by AdminEditor -->
          <textarea 
            id="markdown-editor" 
            class="markdown-editor" 
            placeholder="ここにMarkdownで記事を書いてください...

# 記事タイトル

記事の内容をここに書きます。

## 見出し2

段落の内容...

### 見出し3

- リスト項目1
- リスト項目2

**太字のテキスト**や*斜体のテキスト*も使えます。

> 引用文はこのように表示されます。

詳細は[リンク](https://example.com)をご覧ください。"
          ></textarea>
        </div>

        <div class="editor-pane" id="preview-pane">
           <!-- preview-content is used by inline script, AdminEditor uses previewContainer -->
          <div class="preview-content" id="preview-content">
            <p>プレビューがここに表示されます...</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Message container for AdminEditor -->
  <div id="messageContainer" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;"></div>

  <script src="../js/admin/admin-auth.js"></script>
  <script src="../js/admin/admin-manager.js"></script>
  <script src="../js/app/article-display.js"></script> <!-- markdown-parser.js was moved to js/app/article-display.js -->
  <!-- Include the external AdminEditor script -->
  <script src="../js/admin/admin-editor.js"></script> 
  
  <!-- Removed large inline script block. AdminEditor class from admin-editor.js will handle logic. -->
  <!-- Minimal inline script might be needed for tab switching if not handled by AdminEditor -->
  <script>
    // Tab switching logic (can be moved to AdminEditor or kept minimal here if AdminEditor doesn't handle it)
    // For now, assuming AdminEditor might not handle these specific tab buttons unless IDs match its setup.
    // Or, if AdminEditor is modified to handle these specific IDs.
    // The original inline script had switchTab function. This is a simplified version.
    const editorTabBtn = document.getElementById('editorTabBtn');
    const previewTabBtn = document.getElementById('previewTabBtn');
    const editorPane = document.getElementById('editor-pane');
    const previewPane = document.getElementById('preview-pane');
    const markdownEditor = document.getElementById('markdown-editor');
    const previewContent = document.getElementById('preview-content');
    const localMarkdownParser = new MarkdownParser(); // For this minimal tab logic only

    if (editorTabBtn && previewTabBtn && editorPane && previewPane && markdownEditor && previewContent) {
      editorTabBtn.addEventListener('click', () => {
        editorTabBtn.classList.add('active');
        previewTabBtn.classList.remove('active');
        editorPane.classList.add('active');
        previewPane.classList.remove('active');
      });

      previewTabBtn.addEventListener('click', () => {
        previewTabBtn.classList.add('active');
        editorTabBtn.classList.remove('active');
        previewPane.classList.add('active');
        editorPane.classList.remove('active');
        // Update preview when switching to preview tab
        const markdown = markdownEditor.value;
        previewContent.innerHTML = localMarkdownParser.parse(markdown);
      });
    }

    // The AdminEditor class in admin-editor.js should handle the core editor logic.
    // It has its own DOMContentLoaded listener to initialize.
    // The status display (status-indicator, status-text, save-status) also needs to be
    // managed by AdminEditor or through a common interface if it's to be kept.
    // The AdminEditor class currently does not manage these specific display elements from editor.html.
    // It uses its own showMessage for feedback.

    // Functions like updateStatusDisplay, updateSaveStatus, markAsUnsaved from the old inline script
    // will need to be integrated into AdminEditor or removed if AdminEditor provides alternatives.
    // For example, AdminEditor's this.hasUnsavedChanges and this.updateSaveButtonState() cover some of this.
  </script>
</body>
</html>