<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RBSé™¸ä¸Šæ•™å®¤ - ç®¡ç†ç”»é¢</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif;
      line-height: 1.6;
      color: #2c3e50;
      background: #f8f9fa;
    }

    :root {
      --primary-blue: #4a90e2;
      --primary-teal: #50c8a3;
      --primary-orange: #f5a623;
      --primary-red: #e74c3c;
      --navy-dark: #2c3e50;
      --gray-light: #f8f9fa;
      --gray-medium: #6c757d;
      --white: #ffffff;
    }

    .header {
      background: linear-gradient(135deg, var(--primary-blue), var(--primary-teal));
      color: white;
      padding: 20px 0;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 800;
    }

    .logout-btn {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
      padding: 8px 20px;
      border-radius: 20px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    .nav-tabs {
      display: flex;
      gap: 0;
      margin-bottom: 30px;
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .nav-tab {
      flex: 1;
      padding: 15px 20px;
      background: white;
      border: none;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      color: var(--gray-medium);
      transition: all 0.3s ease;
      border-bottom: 3px solid transparent;
    }

    .nav-tab.active {
      color: var(--primary-blue);
      border-bottom-color: var(--primary-blue);
      background: #f8f9ff;
    }

    .nav-tab:hover {
      background: #f8f9ff;
      color: var(--primary-blue);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .card h2 {
      color: var(--navy-dark);
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: 700;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: var(--primary-blue);
      color: white;
    }

    .btn-primary:hover {
      background: #357abd;
      transform: translateY(-2px);
    }

    .btn-success {
      background: var(--primary-teal);
      color: white;
    }

    .btn-success:hover {
      background: #45b393;
      transform: translateY(-2px);
    }

    .btn-secondary {
      background: var(--gray-medium);
      color: white;
    }

    .btn-secondary:hover {
      background: #5a6268;
      transform: translateY(-2px);
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--navy-dark);
    }

    .form-control {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-blue);
    }

    .radio-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .radio-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      background: #f8f9fa;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .radio-item:hover {
      border-color: var(--primary-blue);
      background: #f0f7ff;
    }

    .radio-item.selected {
      border-color: var(--primary-blue);
      background: var(--primary-blue);
      color: white;
    }

    .alert {
      padding: 15px 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 2px solid #c3e6cb;
    }

    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 2px solid #f5c6cb;
    }

    .alert-info {
      background: #cce7ff;
      color: #004085;
      border: 2px solid #b3d7ff;
    }

    /* çµ±è¨ˆæƒ…å ±ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: #f8f9ff;
      padding: 20px;
      border-radius: 10px;
      border-left: 4px solid var(--primary-blue);
      text-align: center;
    }

    .stat-number {
      font-size: 32px;
      font-weight: 800;
      color: var(--primary-blue);
      margin-bottom: 5px;
    }

    .stat-label {
      color: var(--gray-medium);
      font-size: 14px;
      font-weight: 600;
    }

    /* è¨˜äº‹ä¸€è¦§ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .articles-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    .articles-table th,
    .articles-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #dee2e6;
    }

    .articles-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: var(--navy-dark);
    }

    .articles-table tr:hover {
      background: #f8f9ff;
    }

    .category-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      color: white;
    }

    .category-announcement { background: var(--primary-blue); }
    .category-trial { background: var(--primary-teal); }
    .category-media { background: #9b59b6; }
    .category-important { background: var(--primary-red); }

    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-published {
      background: #d4edda;
      color: #155724;
    }

    .status-draft {
      background: #fff3cd;
      color: #856404;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--gray-medium);
    }

    .loading-spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary-blue);
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      .nav-tabs {
        flex-direction: column;
      }

      .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }

      .container {
        padding: 20px 15px;
      }

      .card {
        padding: 20px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ -->
  <div id="loading-screen" class="loading">
    <div class="loading-spinner"></div>
    <p>ç®¡ç†ç”»é¢ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
  </div>

  <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
  <div id="main-content" style="display: none;">
    <div class="header">
      <div class="header-content">
        <h1>ğŸƒâ€â™‚ï¸ RBSé™¸ä¸Šæ•™å®¤ ç®¡ç†ç”»é¢</h1>
        <button class="logout-btn" id="logout-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </div>

    <div class="container">
      <!-- ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
      <div id="alert-area"></div>

      <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="dashboard">ğŸ“Š ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</button>
        <button class="nav-tab" data-tab="articles">ğŸ“ è¨˜äº‹ç®¡ç†</button>
        <button class="nav-tab" data-tab="status">ğŸ“… ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³</button>
        <button class="nav-tab" data-tab="settings">âš™ï¸ è¨­å®š</button>
      </div>

      <!-- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¿ãƒ– -->
      <div id="dashboard" class="tab-content active">
        <div class="card">
          <h2>ğŸ“Š çµ±è¨ˆæƒ…å ±</h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number" id="total-articles">0</div>
              <div class="stat-label">ç·è¨˜äº‹æ•°</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="published-articles">0</div>
              <div class="stat-label">å…¬é–‹æ¸ˆã¿</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="draft-articles">0</div>
              <div class="stat-label">ä¸‹æ›¸ã</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="this-month-articles">0</div>
              <div class="stat-label">ä»Šæœˆã®è¨˜äº‹</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>ğŸ“ æœ€è¿‘ã®è¨˜äº‹</h2>
          <div id="recent-articles">
            <p>è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>

        <div class="card">
          <h2>ğŸ”— ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
          <div style="display: flex; gap: 15px; flex-wrap: wrap;">
            <button class="btn btn-primary" id="quick-new-article">æ–°ã—ã„è¨˜äº‹ã‚’ä½œæˆ</button>
            <button class="btn btn-success" id="quick-lesson-status">ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ã‚’æ›´æ–°</button>
            <a href="../index.html" target="_blank" class="btn btn-secondary">ã‚µã‚¤ãƒˆã‚’ç¢ºèª</a>
          </div>
        </div>
      </div>

      <!-- è¨˜äº‹ç®¡ç†ã‚¿ãƒ– -->
      <div id="articles" class="tab-content">
        <div class="card">
          <h2>ğŸ“ è¨˜äº‹ç®¡ç†</h2>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
              <button class="btn btn-primary" id="new-article-btn">æ–°ã—ã„è¨˜äº‹ã‚’ä½œæˆ</button>
            </div>
            <div>
              <input type="text" id="search-input" placeholder="è¨˜äº‹ã‚’æ¤œç´¢..." class="form-control" style="width: 300px; margin: 0;">
            </div>
          </div>
          <div id="articles-content">
            <p>è¨˜äº‹ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
          </div>
        </div>
      </div>

      <!-- ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ã‚¿ãƒ– -->
      <div id="status" class="tab-content">
        <div class="card">
          <h2>ğŸ“… ãƒ¬ãƒƒã‚¹ãƒ³é–‹å‚¬çŠ¶æ³</h2>
          <form id="status-form">
            <!-- å…¨ä½“é–‹å‚¬çŠ¶æ³ -->
            <div class="form-group">
              <label>æœ¬æ—¥ã®é–‹å‚¬çŠ¶æ³</label>
              <div class="radio-group">
                <label class="radio-item">
                  <input type="radio" name="overallStatus" value="running" checked>
                  <span>é–‹å‚¬ä¸­</span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="overallStatus" value="scheduled">
                  <span>é–‹å‚¬äºˆå®š</span>
                </label>
                <label class="radio-item">
                  <input type="radio" name="overallStatus" value="cancelled">
                  <span>ä¸­æ­¢</span>
                </label>
              </div>
            </div>

            <div class="form-group">
              <label for="overall-note">è£œè¶³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆä»»æ„ï¼‰</label>
              <input type="text" id="overall-note" name="overallNote" class="form-control" 
                     placeholder="ä¾‹ï¼šé›¨å¤©ã®ãŸã‚å±‹å†…ã§å®Ÿæ–½">
            </div>

            <!-- å€‹åˆ¥ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0;">
              <!-- ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‚³ãƒ¼ã‚¹ -->
              <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <h3 style="margin-bottom: 15px;">ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‚³ãƒ¼ã‚¹ï¼ˆ17:00-17:50ï¼‰</h3>
                <div class="form-group">
                  <label>é–‹å‚¬çŠ¶æ³</label>
                  <div class="radio-group" style="flex-direction: column; gap: 10px;">
                    <label class="radio-item">
                      <input type="radio" name="basicStatus" value="running" checked>
                      <span>é–‹å‚¬ä¸­</span>
                    </label>
                    <label class="radio-item">
                      <input type="radio" name="basicStatus" value="scheduled">
                      <span>é–‹å‚¬äºˆå®š</span>
                    </label>
                    <label class="radio-item">
                      <input type="radio" name="basicStatus" value="cancelled">
                      <span>ä¸­æ­¢</span>
                    </label>
                  </div>
                </div>
                <div class="form-group">
                  <label for="basic-note">è£œè¶³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                  <input type="text" id="basic-note" name="basicNote" class="form-control" 
                         placeholder="ä¾‹ï¼šæ™‚é–“å¤‰æ›´ã‚ã‚Š">
                </div>
              </div>

              <!-- ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚³ãƒ¼ã‚¹ -->
              <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <h3 style="margin-bottom: 15px;">ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚³ãƒ¼ã‚¹ï¼ˆ18:00-18:50ï¼‰</h3>
                <div class="form-group">
                  <label>é–‹å‚¬çŠ¶æ³</label>
                  <div class="radio-group" style="flex-direction: column; gap: 10px;">
                    <label class="radio-item">
                      <input type="radio" name="advanceStatus" value="running">
                      <span>é–‹å‚¬ä¸­</span>
                    </label>
                    <label class="radio-item">
                      <input type="radio" name="advanceStatus" value="scheduled" checked>
                      <span>é–‹å‚¬äºˆå®š</span>
                    </label>
                    <label class="radio-item">
                      <input type="radio" name="advanceStatus" value="cancelled">
                      <span>ä¸­æ­¢</span>
                    </label>
                  </div>
                </div>
                <div class="form-group">
                  <label for="advance-note">è£œè¶³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</label>
                  <input type="text" id="advance-note" name="advanceNote" class="form-control" 
                         placeholder="ä¾‹ï¼šæ™‚é–“å¤‰æ›´ã‚ã‚Š">
                </div>
              </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
              <button type="submit" class="btn btn-success" id="save-status-btn">ğŸ’¾ ä¿å­˜ã—ã¦å…¬é–‹</button>
            </div>
          </form>
        </div>
      </div>

      <!-- è¨­å®šã‚¿ãƒ– -->
      <div id="settings" class="tab-content">
        <div class="card">
          <h2>âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š</h2>
          <div class="form-group">
            <label>ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</label>
            <button class="btn btn-secondary" id="export-btn">è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
          </div>
          <div class="form-group">
            <label>ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</label>
            <input type="file" id="import-file" accept=".json" class="form-control">
            <button class="btn btn-secondary" id="import-btn" style="margin-top: 10px;">è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
          </div>
          <div class="form-group">
            <label>ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½</label>
            <button class="btn btn-secondary" id="debugBtn">ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’å‡ºåŠ›</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ -->
  <script src="../js/admin-auth.js"></script>
  <script src="../js/admin-manager.js"></script>

  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let adminAuth;
    let adminManager;
    let currentTab = 'dashboard';

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        console.log('ç®¡ç†ç”»é¢ã‚’åˆæœŸåŒ–ä¸­...');
        
        // èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–
        adminAuth = new AdminAuth();
        
        // èªè¨¼ãƒã‚§ãƒƒã‚¯
        if (!adminAuth.isAuthenticated()) {
          console.log('èªè¨¼ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚');
          window.location.href = 'login.html';
          return;
        }

        console.log('èªè¨¼OK');

        // ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–
        adminManager = new AdminManager();
        await adminManager.loadArticles();

        console.log('è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', adminManager.articles.length, 'ä»¶');
        console.log('è¨˜äº‹ãƒ‡ãƒ¼ã‚¿è©³ç´°:', adminManager.articles);

        // UIåˆæœŸåŒ–
        setupEventListeners();
        setupRadioButtons();
        
        // åˆæœŸè¡¨ç¤º
        await renderDashboard();
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’éè¡¨ç¤ºã«ã—ã¦ãƒ¡ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
        
        console.log('ç®¡ç†ç”»é¢ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ');
      } catch (error) {
        console.error('åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
        showAlert('ç®¡ç†ç”»é¢ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
        
        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã‚‚ãƒ¡ã‚¤ãƒ³ç”»é¢ã‚’è¡¨ç¤º
        document.getElementById('loading-screen').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
      }
    });

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®š
    function setupEventListeners() {
      console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’è¨­å®šä¸­...');
      
      // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³
      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', handleLogout);
      }

      // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', function(e) {
          e.preventDefault();
          const tabName = this.getAttribute('data-tab');
          console.log('ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ:', tabName);
          switchTab(tabName);
        });
      });

      // ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
      const quickNewArticle = document.getElementById('quick-new-article');
      if (quickNewArticle) {
        quickNewArticle.addEventListener('click', () => switchTab('articles'));
      }

      const quickLessonStatus = document.getElementById('quick-lesson-status');
      if (quickLessonStatus) {
        quickLessonStatus.addEventListener('click', () => switchTab('status'));
      }

      // è¨˜äº‹ç®¡ç†ãƒœã‚¿ãƒ³
      const newArticleBtn = document.getElementById('new-article-btn');
      if (newArticleBtn) {
        newArticleBtn.addEventListener('click', createNewArticle);
      }

      // æ¤œç´¢æ©Ÿèƒ½
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', function(e) {
          handleSearch(e.target.value);
        });
      }

      // ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ãƒ•ã‚©ãƒ¼ãƒ 
      const statusForm = document.getElementById('status-form');
      if (statusForm) {
        statusForm.addEventListener('submit', handleStatusSubmit);
      }

      // è¨­å®šãƒœã‚¿ãƒ³
      const exportBtn = document.getElementById('export-btn');
      if (exportBtn) {
        exportBtn.addEventListener('click', exportData);
      }

      const importBtn = document.getElementById('import-btn');
      if (importBtn) {
        importBtn.addEventListener('click', importData);
      }

      console.log('ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸ');
    }

    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã®è¦‹ãŸç›®ã‚’è¨­å®š
    function setupRadioButtons() {
      document.querySelectorAll('.radio-item').forEach(item => {
        const radio = item.querySelector('input[type="radio"]');
        
        if (radio && radio.checked) {
          item.classList.add('selected');
        }
        
        item.addEventListener('click', function(e) {
          e.preventDefault();
          const name = radio.name;
          document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
            r.closest('.radio-item').classList.remove('selected');
          });
          
          radio.checked = true;
          item.classList.add('selected');
        });
      });
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function switchTab(tabName) {
      console.log('ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆ:', tabName);
      
      // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
      document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });

      // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
      const targetTab = document.querySelector(`[data-tab="${tabName}"]`);
      const targetContent = document.getElementById(tabName);
      
      if (targetTab && targetContent) {
        targetTab.classList.add('active');
        targetContent.classList.add('active');
        currentTab = tabName;

        // ã‚¿ãƒ–å›ºæœ‰ã®å‡¦ç†
        if (tabName === 'articles') {
          renderArticleList();
        } else if (tabName === 'dashboard') {
          renderDashboard();
        } else if (tabName === 'status') {
          loadCurrentStatus();
        }
      }
    }

    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤º
    async function renderDashboard() {
      if (!adminManager) {
        console.log('adminManagerãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“');
        return;
      }

      try {
        console.log('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¡¨ç¤ºä¸­...', adminManager.articles);
        
        const stats = adminManager.getStats();
        
        console.log('çµ±è¨ˆæƒ…å ±ã‚’DOMã«è¨­å®š:', stats);
        
        // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
        document.getElementById('total-articles').textContent = stats.total;
        document.getElementById('published-articles').textContent = stats.published;
        document.getElementById('draft-articles').textContent = stats.draft;
        document.getElementById('this-month-articles').textContent = stats.thisMonth;

        // æœ€è¿‘ã®è¨˜äº‹ã‚’è¡¨ç¤º
        renderRecentArticles();
      } catch (error) {
        console.error('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒ©ãƒ¼:', error);
        showAlert('ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®è¡¨ç¤ºã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // æœ€è¿‘ã®è¨˜äº‹ã‚’è¡¨ç¤º
    function renderRecentArticles() {
      const container = document.getElementById('recent-articles');
      if (!container || !adminManager) return;

      console.log('æœ€è¿‘ã®è¨˜äº‹ã‚’è¡¨ç¤ºä¸­...', adminManager.articles);

      const articles = adminManager.articles
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 5);

      console.log('ã‚½ãƒ¼ãƒˆãƒ»ãƒ•ã‚£ãƒ«ã‚¿å¾Œã®è¨˜äº‹:', articles);

      if (articles.length === 0) {
        container.innerHTML = '<p>è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const html = articles.map(article => `
        <div style="padding: 10px; border-bottom: 1px solid #dee2e6;">
          <strong>${escapeHtml(article.title)}</strong>
          <span class="category-badge category-${article.category}" style="margin-left: 10px;">
            ${escapeHtml(article.categoryName)}
          </span>
          <span class="status-badge status-${article.status || 'published'}" style="margin-left: 5px;">
            ${article.status === 'draft' ? 'ä¸‹æ›¸ã' : 'å…¬é–‹æ¸ˆã¿'}
          </span>
          <div style="font-size: 12px; color: #6c757d; margin-top: 5px;">
            ${adminManager.formatDate(article.date)}
          </div>
        </div>
      `).join('');

      container.innerHTML = html;
    }

    // è¨˜äº‹ä¸€è¦§ã‚’è¡¨ç¤º
    function renderArticleList() {
      const container = document.getElementById('articles-content');
      if (!container || !adminManager) return;

      const articles = adminManager.getFilteredArticles();

      if (articles.length === 0) {
        container.innerHTML = '<p>è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
      }

      const html = `
        <table class="articles-table">
          <thead>
            <tr>
              <th>ã‚¿ã‚¤ãƒˆãƒ«</th>
              <th>ã‚«ãƒ†ã‚´ãƒªãƒ¼</th>
              <th>æ—¥ä»˜</th>
              <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            ${articles.map(article => `
              <tr>
                <td>
                  <strong>${escapeHtml(article.title)}</strong>
                  <br>
                  <small style="color: #6c757d;">${escapeHtml(article.excerpt)}</small>
                </td>
                <td>
                  <span class="category-badge category-${article.category}">
                    ${escapeHtml(article.categoryName)}
                  </span>
                </td>
                <td>${adminManager.formatDate(article.date)}</td>
                <td>
                  <span class="status-badge status-${article.status || 'published'}">
                    ${article.status === 'draft' ? 'ä¸‹æ›¸ã' : 'å…¬é–‹æ¸ˆã¿'}
                  </span>
                </td>
                <td>
                  <button class="btn btn-primary btn-sm" onclick="editArticle(${article.id})">ç·¨é›†</button>
                  <button class="btn btn-secondary btn-sm" onclick="toggleStatus(${article.id})">
                    ${article.status === 'draft' ? 'å…¬é–‹' : 'ä¸‹æ›¸ãã«æˆ»ã™'}
                  </button>
                  <button class="btn btn-secondary btn-sm" onclick="deleteArticle(${article.id})">å‰Šé™¤</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;

      container.innerHTML = html;
    }

    // æ¤œç´¢å‡¦ç†
    function handleSearch(query) {
      if (!adminManager) return;
      
      adminManager.searchQuery = query;
      if (currentTab === 'articles') {
        renderArticleList();
      }
    }

    // ç¾åœ¨ã®ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ã‚’èª­ã¿è¾¼ã¿
    function loadCurrentStatus() {
      try {
        const storedData = localStorage.getItem('rbs_lesson_status');
        
        if (storedData) {
          const statusData = JSON.parse(storedData);
          console.log('ä¿å­˜ã•ã‚ŒãŸãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', statusData);
          
          // ãƒ•ã‚©ãƒ¼ãƒ ã«å€¤ã‚’è¨­å®š
          const form = document.getElementById('status-form');
          if (form) {
            // å…¨ä½“é–‹å‚¬çŠ¶æ³
            const overallRadio = form.querySelector(`input[name="overallStatus"][value="${statusData.overallStatus}"]`);
            if (overallRadio) {
              overallRadio.checked = true;
            }
            
            // å…¨ä½“è£œè¶³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const overallNote = form.querySelector('#overall-note');
            if (overallNote) {
              overallNote.value = statusData.overallNote || '';
            }
            
            // ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‚³ãƒ¼ã‚¹
            if (statusData.lessons && statusData.lessons[0]) {
              const basicRadio = form.querySelector(`input[name="basicStatus"][value="${statusData.lessons[0].status}"]`);
              if (basicRadio) {
                basicRadio.checked = true;
              }
              
              const basicNote = form.querySelector('#basic-note');
              if (basicNote) {
                basicNote.value = statusData.lessons[0].note || '';
              }
            }
            
            // ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚³ãƒ¼ã‚¹
            if (statusData.lessons && statusData.lessons[1]) {
              const advanceRadio = form.querySelector(`input[name="advanceStatus"][value="${statusData.lessons[1].status}"]`);
              if (advanceRadio) {
                advanceRadio.checked = true;
              }
              
              const advanceNote = form.querySelector('#advance-note');
              if (advanceNote) {
                advanceNote.value = statusData.lessons[1].note || '';
              }
            }
          }
        } else {
          console.log('ä¿å­˜ã•ã‚ŒãŸãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚');
        }
      } catch (error) {
        console.error('ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—:', error);
        showAlert('ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    async function handleStatusSubmit(e) {
      e.preventDefault();
      
      try {
        const formData = new FormData(e.target);
        const statusData = {
          overallStatus: formData.get('overallStatus'),
          overallNote: formData.get('overallNote') || '',
          lessons: [
            {
              timeSlot: '17:00-17:50',
              courseName: 'ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ã‚³ãƒ¼ã‚¹ï¼ˆå¹´é•·ã€œå°3ï¼‰',
              status: formData.get('basicStatus'),
              note: formData.get('basicNote') || ''
            },
            {
              timeSlot: '18:00-18:50',
              courseName: 'ã‚¢ãƒ‰ãƒãƒ³ã‚¹ã‚³ãƒ¼ã‚¹ï¼ˆå°4ã€œå°6ï¼‰',
              status: formData.get('advanceStatus'),
              note: formData.get('advanceNote') || ''
            }
          ],
          lastUpdated: new Date().toISOString()
        };

        // LocalStorageã«ä¿å­˜
        localStorage.setItem('rbs_lesson_status', JSON.stringify(statusData));
        
        console.log('ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ã‚’ä¿å­˜ã—ã¾ã—ãŸ:', statusData);
        showAlert('âœ… ãƒ¬ãƒƒã‚¹ãƒ³çŠ¶æ³ãŒæ­£å¸¸ã«æ›´æ–°ã•ã‚Œã¾ã—ãŸï¼', 'success');
        
      } catch (error) {
        console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        showAlert(`âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
      }
    }

    // è¨˜äº‹æ“ä½œé–¢æ•°
    function createNewArticle() {
      window.location.href = 'editor.html';
    }

    function editArticle(id) {
      window.location.href = `editor.html?id=${id}`;
    }

    async function toggleStatus(id) {
      if (!adminManager) return;
      
      try {
        await adminManager.toggleArticleStatus(id);
        await renderDashboard();
        if (currentTab === 'articles') {
          renderArticleList();
        }
        showAlert('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ã¾ã—ãŸ', 'success');
      } catch (error) {
        console.error('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
        showAlert('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    async function deleteArticle(id) {
      if (!adminManager) return;
      
      if (!confirm('ã“ã®è¨˜äº‹ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
      
      try {
        await adminManager.deleteArticle(id);
        await renderDashboard();
        if (currentTab === 'articles') {
          renderArticleList();
        }
        showAlert('è¨˜äº‹ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
      } catch (error) {
        console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
        showAlert('è¨˜äº‹ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
      }
    }

    // ãƒ‡ãƒ¼ã‚¿æ“ä½œé–¢æ•°
    function exportData() {
      if (adminManager) {
        adminManager.exportData();
      }
    }

    async function importData() {
      const fileInput = document.getElementById('import-file');
      const file = fileInput.files[0];
      
      if (!file) {
        alert('ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
        return;
      }

      if (adminManager) {
        try {
          await adminManager.importData(file);
          showAlert('âœ… ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');
          await renderDashboard();
        } catch (error) {
          console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
          showAlert(`âŒ ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`, 'error');
        }
      }
    }

    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
    function handleLogout() {
      if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        if (adminAuth) {
          adminAuth.logout();
        } else {
          window.location.href = 'login.html';
        }
      }
    }

    // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
    function showAlert(message, type) {
      const alertArea = document.getElementById('alert-area');
      const alertClass = `alert-${type}`;
      const alertHtml = `
        <div class="alert ${alertClass}">
          ${escapeHtml(message)}
        </div>
      `;
      
      alertArea.innerHTML = alertHtml;
      
      setTimeout(() => {
        alertArea.innerHTML = '';
      }, 5000);
    }

    // HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
  </script>
</body>
</html> 