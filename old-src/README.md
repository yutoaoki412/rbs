# RBS陸上教室 統合管理システム

RBS陸上教室のウェブサイトと管理システムの統合版です。記事管理とレッスン状況管理を一つの管理画面で行えます。

## 🚀 主な機能

### 📝 記事管理システム
- **記事の作成・編集・削除**: Markdownエディターで直感的に記事を作成
- **ステータス管理**: 下書き/公開の切り替え
- **カテゴリー管理**: お知らせ、体験会、メディア、重要の4カテゴリー
- **検索・フィルタリング**: 記事の検索とカテゴリー別フィルタリング
- **一括操作**: 複数記事の一括公開/下書き化/削除

### 📅 レッスン状況管理
- **リアルタイム更新**: 管理画面で設定した内容が即座にサイトに反映
- **個別コース管理**: ベーシック・アドバンスコースの個別状況設定
- **全体状況管理**: 全体の開催状況（開催中/開催予定/中止）
- **補足メッセージ**: 各コースや全体に対する補足情報

### 🔐 認証システム
- **統一認証**: 一つのパスワードで全機能にアクセス
- **セッション管理**: 24時間有効なセッション
- **自動ログアウト**: 30分非アクティブで自動ログアウト
- **セキュリティログ**: ログイン試行の記録

## 🏗️ システム構成

### フロントエンド
- **index.html**: メインページ（ニュース表示、レッスン状況表示）
- **news.html**: ニュース一覧ページ
- **news-detail.html**: ニュース詳細ページ
- **admin/**: 管理画面（統合ダッシュボード）

### バックエンド（Cloudflare Functions）
- **functions/api/status.js**: レッスン状況管理API
- **functions/_middleware.js**: 共通ミドルウェア

### データ管理
- **LocalStorage**: 記事データ（ブラウザローカル）
- **Cloudflare KV**: レッスン状況データ（クラウド）

## 📦 セットアップ

### 1. 環境設定

```bash
# 依存関係のインストール
npm install

# Cloudflare CLI のインストール（未インストールの場合）
npm install -g wrangler
```

### 2. Cloudflare設定

```bash
# Cloudflareにログイン
wrangler login

# KVネームスペースを作成
wrangler kv:namespace create "RBS_KV"
wrangler kv:namespace create "RBS_KV" --preview

# wrangler.tomlのKV IDを更新
```

### 3. 環境変数設定

`wrangler.toml`で管理者パスワードを設定：

```toml
[vars]
ADMIN_PASSWORD = "your-secure-password"
```

### 4. デプロイ

```bash
# プレビュー環境
wrangler pages dev

# 本番環境
wrangler pages publish
```

## 🎯 使い方

### 管理画面アクセス
1. `https://your-domain.com/admin/` にアクセス
2. 設定したパスワードでログイン
3. 統合ダッシュボードから各機能を利用

### 記事管理
1. **記事管理**タブで記事一覧を確認
2. **新しい記事を作成**ボタンで記事作成
3. Markdownエディターで記事を執筆
4. プレビューで確認後、公開

### レッスン状況管理
1. **レッスン状況**タブで現在の状況を確認
2. 各コースの開催状況を選択
3. 必要に応じて補足メッセージを入力
4. **保存して公開**で即座にサイトに反映

## 🔧 カスタマイズ

### パスワード変更
```javascript
// wrangler.tomlで設定
[vars]
ADMIN_PASSWORD = "new-password"
```

### データバックアップ
管理画面の**設定**タブから：
- **データエクスポート**: 記事データをJSONファイルでダウンロード
- **データインポート**: バックアップファイルから復元

## 🚨 トラブルシューティング

### よくある問題

1. **管理画面にアクセスできない**
   - パスワードが正しいか確認
   - ブラウザのキャッシュをクリア

2. **レッスン状況が更新されない**
   - Cloudflare KVの設定を確認
   - ネットワーク接続を確認

3. **記事が表示されない**
   - LocalStorageのデータを確認
   - ブラウザの開発者ツールでエラーを確認

### ログの確認
```bash
# Cloudflare Functions のログ
wrangler tail

# ブラウザの開発者ツール
F12 → Console タブ
```

## 📱 対応ブラウザ
- Chrome 80+
- Firefox 75+
- Safari 13+
- Edge 80+

## 🔒 セキュリティ

- パスワード認証による管理画面保護
- セッション管理による自動ログアウト
- HTTPS通信の強制
- XSS対策済み

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 🤝 サポート

問題や質問がある場合は、GitHubのIssuesまでお気軽にお問い合わせください。 