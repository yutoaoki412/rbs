<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理画面 - RBS陸上教室</title>
  <meta name="description" content="RBS陸上教室の管理画面">
  <meta name="robots" content="noindex, nofollow">
  
  <!-- CSS -->
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/components.css">
  <link rel="stylesheet" href="../css/admin.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">
  
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="page-admin">
  <!-- ヘッダーコンテナ（新アーキテクチャ対応） -->
  <div id="header-container"></div>

  <!-- ヘッダー -->
  <header class="admin-header">
    <div class="header-left">
      <i class="fas fa-running admin-logo-icon"></i>
      <span class="admin-logo-text">RBS陸上教室 管理画面</span>
    </div>
    <div class="header-right">
      <!-- デバッグ情報表示ボタン -->
      <button class="btn btn-outline" data-action="show-debug-info" title="デバッグ情報">
        <i class="fas fa-bug"></i>
      </button>
      <button class="logout-btn" data-action="logout">
        <i class="fas fa-sign-out-alt"></i>
        ログアウト
      </button>
    </div>
  </header>

  <!-- メインコンテンツ -->
  <div class="admin-container">
    <!-- サイドバー -->
    <aside class="admin-sidebar">
      <nav class="sidebar-nav">
        <div class="nav-item active" data-tab="dashboard" data-action="switch-tab">
          <i class="fas fa-chart-bar"></i>
          <span>ダッシュボード</span>
        </div>
        <div class="nav-item" data-tab="news-management" data-action="switch-tab">
          <i class="fas fa-newspaper"></i>
          <span>記事管理</span>
        </div>
        <div class="nav-item" data-tab="lesson-status" data-action="switch-tab">
          <i class="fas fa-calendar-check"></i>
          <span>レッスン状況</span>
        </div>
        <div class="nav-item" data-tab="settings" data-action="switch-tab">
          <i class="fas fa-cog"></i>
          <span>設定</span>
        </div>
      </nav>
    </aside>

    <!-- メインエリア -->
    <main class="admin-main">
      <!-- ダッシュボード -->
      <section id="dashboard" class="admin-section active">
        <div class="section-header">
          <h1><i class="fas fa-chart-bar"></i> ダッシュボード</h1>
        </div>
        
        <!-- 統計カード -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">
              <i class="fas fa-newspaper"></i>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="total-articles">0</div>
              <div class="stat-label">総記事数</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon published">
              <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="published-articles">0</div>
              <div class="stat-label">公開済み</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon draft">
              <i class="fas fa-edit"></i>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="draft-articles">0</div>
              <div class="stat-label">下書き</div>
            </div>
          </div>
          
          <div class="stat-card">
            <div class="stat-icon current-month">
              <i class="fas fa-calendar"></i>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="current-month-articles">0</div>
              <div class="stat-label">今月の記事</div>
            </div>
          </div>
        </div>

        <!-- 最近の記事 -->
        <div class="dashboard-widgets">
          <div class="widget">
            <div class="widget-header">
              <h2><i class="fas fa-newspaper"></i> 最近の記事</h2>
              <div class="widget-header-actions">
                <button class="btn-icon" data-action="refresh-recent-articles" title="更新">
                  <i class="fas fa-sync-alt"></i>
                </button>
                <button class="btn-icon" onclick="window.actionHandler?.debugStatus()" title="ActionHandlerデバッグ">
                  <i class="fas fa-bug"></i>
                </button>
              </div>
            </div>
            <div class="widget-content">
              <div id="recent-articles">
                <div class="loading-state">
                  <i class="fas fa-spinner fa-spin"></i>
                  記事を読み込み中...
                </div>
              </div>
            </div>
          </div>

          <!-- クイックアクション -->
          <div class="widget quick-actions">
            <div class="widget-header">
              <h2><i class="fas fa-bolt"></i> クイックアクション</h2>
            </div>
            <div class="widget-content">
              <div class="action-buttons">
                <button class="action-btn primary" data-action="switch-tab" data-tab="news-management">
                  <i class="fas fa-plus"></i>
                  新しい記事を作成
                </button>
                <button class="action-btn success" data-action="switch-tab" data-tab="lesson-status">
                  <i class="fas fa-calendar-check"></i>
                  レッスン状況を更新
                </button>
                <button class="action-btn secondary" data-action="open-external" data-url="index.html">
                  <i class="fas fa-external-link-alt"></i>
                  サイトを確認
                </button>
                <button class="action-btn info" data-action="open-external" data-url="news.html">
                  <i class="fas fa-newspaper"></i>
                  ニュース一覧を確認
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- 記事管理 -->
      <section id="news-management" class="admin-section">
        <div class="section-header">
          <h1>記事管理</h1>
          <div class="section-actions">
            <button class="btn btn-info" data-action="test-article-service">
              連携テスト
            </button>
          </div>
        </div>
        
        <div class="management-layout">
          <!-- 記事エディター -->
          <div class="editor-panel">
            <div class="panel-header">
              <h2 id="editor-title">新規記事作成</h2>
              <div class="panel-actions">
                <button class="btn btn-outline" data-action="clear-news-editor">
                  クリア
                </button>
                <button class="btn btn-secondary" data-action="preview-news">
                  プレビュー
                </button>
                <button class="btn btn-primary" data-action="save-news">
                  保存
                </button>
                <button class="btn btn-success" data-action="publish-news">
                  公開
                </button>
              </div>
            </div>
            
            <form class="editor-form">
              <input type="hidden" id="news-id">
              
              <div class="form-grid">
                <div class="form-group">
                  <label for="news-title">
                    タイトル <span class="required">*</span>
                  </label>
                  <input type="text" id="news-title" class="form-input" placeholder="記事のタイトルを入力してください" required>
                </div>
                <div class="form-group">
                  <label for="news-category">
                    カテゴリー
                  </label>
                  <select id="news-category" class="form-select">
                    <option value="announcement">お知らせ</option>
                    <option value="event">体験会</option>
                    <option value="media">メディア</option>
                    <option value="important">重要</option>
                  </select>
                </div>
              </div>
              
              <div class="form-grid">
                <div class="form-group">
                  <label for="news-date">
                    公開日
                  </label>
                  <input type="date" id="news-date" class="form-input">
                </div>
                <div class="form-group">
                  <label for="news-status">
                    ステータス
                  </label>
                  <select id="news-status" class="form-select">
                    <option value="draft">下書き</option>
                    <option value="published">公開</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="news-summary">
                  概要
                </label>
                <textarea id="news-summary" class="form-textarea" rows="3" placeholder="記事の概要を入力してください（記事一覧で表示されます）"></textarea>
              </div>
              
              <div class="form-group">
                <label for="news-content">
                  本文 <span class="required">*</span>
                </label>
                <div class="editor-toolbar">
                  <button type="button" class="toolbar-btn" data-action="insert-markdown" data-start="**" data-end="**" title="太字">
                    <strong>B</strong>
                  </button>
                  <button type="button" class="toolbar-btn" data-action="insert-markdown" data-start="## " data-end="" title="見出し">
                    H2
                  </button>
                  <button type="button" class="toolbar-btn" data-action="insert-markdown" data-start="- " data-end="" title="リスト">
                    List
                  </button>
                  <button type="button" class="toolbar-btn" data-action="insert-markdown" data-start="[" data-end="](URL)" title="リンク">
                    Link
                  </button>
                </div>
                <textarea id="news-content" class="form-textarea editor-content" placeholder="記事の本文をMarkdown形式で入力してください" required></textarea>
                <div class="form-help">
                  <small>Markdown記法: **太字**、## 見出し、- リスト、[リンク](URL)</small>
                </div>
              </div>
              
              <div class="form-group">
                <label>
                  <input type="checkbox" id="news-featured"> 注目記事として表示する
                </label>
              </div>
            </form>
          </div>
          
          <!-- 記事一覧 -->
          <div class="list-panel">
            <div class="panel-header">
              <h2>記事一覧</h2>
              <div class="panel-filters">
                <select id="news-filter" class="form-select" data-action="filter-news-list" data-target="news-filter">
                  <option value="all">すべて</option>
                  <option value="published">公開中</option>
                  <option value="draft">下書き</option>
                </select>
                <button class="btn btn-outline" data-action="refresh-news-list">
                  更新
                </button>
              </div>
            </div>
            <div id="news-list" class="list-content">
              <!-- 記事一覧がここに表示される -->
              <div class="loading-state">
                記事を読み込み中...
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- レッスン状況 -->
      <section id="lesson-status" class="admin-section">
        <div class="section-header">
          <h1><i class="fas fa-calendar-check"></i> レッスン開催状況</h1>
        </div>
        
        <div class="lesson-panel">
          <div class="panel-header">
            <h2>開催状況設定</h2>
            <div class="status-display">
              <div class="status-item">
                <input type="radio" id="status-scheduled" name="global-status" value="scheduled" checked>
                <label for="status-scheduled">通常開催</label>
              </div>
              <div class="status-item">
                <input type="radio" id="status-cancelled" name="global-status" value="cancelled">
                <label for="status-cancelled">中止</label>
              </div>
              <div class="status-item">
                <input type="radio" id="status-indoor" name="global-status" value="indoor">
                <label for="status-indoor">室内開催</label>
              </div>
              <div class="status-item">
                <input type="radio" id="status-postponed" name="global-status" value="postponed">
                <label for="status-postponed">延期</label>
              </div>
            </div>
          </div>
          
          <div class="lesson-form">
            <div class="form-grid">
              <div class="form-group">
                <label for="lesson-date"><i class="fas fa-calendar"></i> 対象日</label>
                <input type="date" id="lesson-date" class="form-input" value="">
              </div>
              <div class="form-group">
                <label for="global-message"><i class="fas fa-comment"></i> 全体メッセージ（任意）</label>
                <textarea id="global-message" class="form-textarea" rows="3" placeholder="例：雨天のため室内で実施いたします。"></textarea>
                <div class="form-help">
                  <small>このメッセージはトップページの開催状況に表示されます</small>
                </div>
              </div>
            </div>
            
            <div class="courses-grid">
              <div class="course-card">
                <div class="course-header">
                  <h3>ベーシックコース</h3>
                  <p>年長〜小3対象 / 17:00-17:50</p>
                </div>
                <div class="course-content">
                  <div class="status-buttons">
                    <input type="radio" name="basic-lesson" value="通常開催" id="basic-lesson-scheduled" checked>
                    <label for="basic-lesson-scheduled" class="status-btn">
                      <i class="fas fa-check-circle"></i>
                      通常開催
                    </label>
                    <input type="radio" name="basic-lesson" value="中止" id="basic-lesson-cancelled">
                    <label for="basic-lesson-cancelled" class="status-btn">
                      <i class="fas fa-times-circle"></i>
                      中止
                    </label>
                    <input type="radio" name="basic-lesson" value="室内開催" id="basic-lesson-indoor">
                    <label for="basic-lesson-indoor" class="status-btn">
                      <i class="fas fa-home"></i>
                      室内開催
                    </label>
                    <input type="radio" name="basic-lesson" value="延期" id="basic-lesson-postponed">
                    <label for="basic-lesson-postponed" class="status-btn">
                      <i class="fas fa-clock"></i>
                      延期
                    </label>
                  </div>
                </div>
              </div>
              
              <div class="course-card">
                <div class="course-header">
                  <h3>アドバンスコース</h3>
                  <p>小4〜小6対象 / 18:00-18:50</p>
                </div>
                <div class="course-content">
                  <div class="status-buttons">
                    <input type="radio" name="advance-lesson" value="通常開催" id="advance-lesson-scheduled" checked>
                    <label for="advance-lesson-scheduled" class="status-btn">
                      <i class="fas fa-check-circle"></i>
                      通常開催
                    </label>
                    <input type="radio" name="advance-lesson" value="中止" id="advance-lesson-cancelled">
                    <label for="advance-lesson-cancelled" class="status-btn">
                      <i class="fas fa-times-circle"></i>
                      中止
                    </label>
                    <input type="radio" name="advance-lesson" value="室内開催" id="advance-lesson-indoor">
                    <label for="advance-lesson-indoor" class="status-btn">
                      <i class="fas fa-home"></i>
                      室内開催
                    </label>
                    <input type="radio" name="advance-lesson" value="延期" id="advance-lesson-postponed">
                    <label for="advance-lesson-postponed" class="status-btn">
                      <i class="fas fa-clock"></i>
                      延期
                    </label>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="form-actions">
              <button class="btn btn-secondary" data-action="load-lesson-status">
                <i class="fas fa-download"></i> 現在の状況を読み込み
              </button>
              <button class="btn btn-outline" data-action="preview-lesson-status">
                <i class="fas fa-eye"></i> プレビュー
              </button>
              <button class="btn btn-success" data-action="update-lesson-status">
                <i class="fas fa-save"></i> 保存して公開
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- 設定 -->
      <section id="settings" class="admin-section">
        <div class="section-header">
          <h1><i class="fas fa-cog"></i> 設定</h1>
        </div>
        
        <div class="settings-panel">
          <div class="setting-group">
            <h3><i class="fas fa-database"></i> データ管理</h3>
            <p>記事データの管理とバックアップ</p>
            <div class="setting-actions">
              <button class="btn btn-outline" data-action="export-data">
                <i class="fas fa-download"></i> データをエクスポート
              </button>
              <button class="btn btn-outline" data-action="clear-all-data">
                <i class="fas fa-trash"></i> 全データクリア
              </button>
            </div>
          </div>
          
          <div class="setting-group">
            <h3><i class="fas fa-link"></i> サイト連携</h3>
            <p>フロントエンドサイトとの連携状況</p>
            <div class="setting-actions">
              <button class="btn btn-primary" data-action="test-site-connection">
                <i class="fas fa-link"></i> 連携テスト
              </button>
              <div id="site-connection-test-results" class="test-results" style="margin-top: 10px;"></div>
              <button class="btn btn-secondary" data-action="open-external" data-url="news.html">
                <i class="fas fa-external-link-alt"></i> ニュースページを開く
              </button>
            </div>
          </div>
          
          <div class="setting-group">
            <h3><i class="fas fa-bug"></i> デバッグ</h3>
            <p>開発者向けデバッグ機能</p>
            <div class="setting-actions">
              <button class="btn btn-info" data-action="show-debug-info">
                <i class="fas fa-info-circle"></i> デバッグ情報表示
              </button>
              <button class="btn btn-warning" data-action="reset-local-storage">
                <i class="fas fa-redo"></i> LocalStorage リセット
              </button>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- モーダル -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modal-title">プレビュー</h3>
        <button class="modal-close" data-action="close-modal">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body" id="modal-body">
        <!-- プレビュー内容がここに表示される -->
      </div>
    </div>
  </div>

  <!-- 通知エリア -->
  <div id="notification-container" class="notification-container">
    <!-- 通知がここに表示される -->
  </div>

  <!-- フッターコンテナ（新アーキテクチャ対応） -->
  <div id="footer-container"></div>

  <!-- メインアプリケーション（ES6モジュール） -->
  <script type="module" src="../js/main.js"></script>
</body>
</html> 