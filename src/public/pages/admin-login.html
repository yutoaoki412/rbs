<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³ - RBSé™¸ä¸Šæ•™å®¤</title>
  <meta name="description" content="RBSé™¸ä¸Šæ•™å®¤ ç®¡ç†ç”»é¢ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³">
  <meta name="robots" content="noindex, nofollow">
  
  <!-- CSS -->
  <link rel="stylesheet" href="../styles/base.css">
  <link rel="stylesheet" href="../styles/common.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/login.css">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
</head>
<body class="login-page">
  <!-- ãƒ­ã‚°ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ -->
  <div class="login-container">
    <div class="login-card">
      <!-- ãƒ­ã‚´ã¨ã‚¿ã‚¤ãƒˆãƒ« -->
      <div class="login-header">
        <div class="logo">
          <img src="../images/lp-logo.png" alt="RBSé™¸ä¸Šæ•™å®¤" class="logo-image">
        </div>
        <h1 class="login-title">ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³</h1>
        <p class="login-subtitle">RBSé™¸ä¸Šæ•™å®¤ ç®¡ç†ç”»é¢</p>
      </div>

      <!-- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
      <div id="error-message" class="error-message" style="display: none;">
        <div class="error-content">
          <span class="error-icon">âš ï¸</span>
          <span class="error-text"></span>
        </div>
      </div>

      <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
      <form id="login-form" class="login-form">
        <div class="form-group">
          <label for="password" class="form-label">
            <span class="label-text">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</span>
            <span class="required">*</span>
          </label>
          <div class="password-input-wrapper">
            <input 
              type="password" 
              id="password" 
              class="form-input password-input" 
              placeholder="ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
              required 
              autocomplete="current-password"
            >
            <button type="button" class="password-toggle" onclick="togglePasswordVisibility()">
              <span id="password-toggle-icon">ğŸ‘ï¸</span>
            </button>
          </div>
        </div>

        <button type="submit" class="login-btn" id="login-btn">
          <span class="btn-text">ãƒ­ã‚°ã‚¤ãƒ³</span>
          <span class="btn-loading" id="btn-loading" style="display: none;">
            <span class="loading-spinner"></span>
            èªè¨¼ä¸­...
          </span>
        </button>
      </form>

      <!-- ãƒ•ãƒƒã‚¿ãƒ¼ãƒªãƒ³ã‚¯ -->
      <div class="login-footer">
        <a href="index.html" class="back-link">
          <span class="back-icon">â†</span>
          ã‚µã‚¤ãƒˆã«æˆ»ã‚‹
        </a>
      </div>
    </div>

    <!-- èƒŒæ™¯è£…é£¾ -->
    <div class="bg-decoration">
      <div class="decoration-circle circle-1"></div>
      <div class="decoration-circle circle-2"></div>
      <div class="decoration-circle circle-3"></div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="../js/config.js"></script>
  <script src="../js/admin-auth.js"></script>
  
  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let isLoading = false;

    // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’åˆæœŸåŒ–ä¸­...');
      
      // æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆã¯ç®¡ç†ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      if (checkExistingAuth()) {
        console.log('æ—¢ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ - ç®¡ç†ç”»é¢ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ');
        window.location.href = 'admin.html';
        return;
      }

      // ãƒ•ã‚©ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
      setupEventListeners();
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
      document.getElementById('password').focus();
      
      console.log('ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã®åˆæœŸåŒ–å®Œäº†');
    });

    // æ—¢å­˜ã®èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
    function checkExistingAuth() {
      const adminAuth = new AdminAuth();
      return adminAuth.isAuthenticated();
    }

    // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
    function setupEventListeners() {
      // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
      document.getElementById('login-form').addEventListener('submit', handleLogin);
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã®Enterã‚­ãƒ¼
      document.getElementById('password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !isLoading) {
          e.preventDefault();
          handleLogin(e);
        }
      });

      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›æ™‚ã®ã‚¨ãƒ©ãƒ¼ã‚¯ãƒªã‚¢
      document.getElementById('password').addEventListener('input', function() {
        hideError();
      });
    }

    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    async function handleLogin(e) {
      e.preventDefault();
      
      if (isLoading) return;

      const password = document.getElementById('password').value.trim();
      
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (!password) {
        showError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã«è¨­å®š
      setLoadingState(true);
      hideError();

      try {
        // å°‘ã—é…å»¶ã‚’è¿½åŠ ã—ã¦UXã‚’å‘ä¸Š
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // AdminAuthã‚·ã‚¹ãƒ†ãƒ ã‚’ä½¿ç”¨ã—ãŸèªè¨¼å‡¦ç†
        const adminAuth = new AdminAuth();
        const result = await adminAuth.login(password);
        
        if (result.success) {
          // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          console.log('ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ');
          
          // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦ã‹ã‚‰ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
          showSuccessAndRedirect();
        } else {
          // ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—
          console.log('ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—:', result.message);
          showError(result.message);
          
          // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¯ãƒªã‚¢
          document.getElementById('password').value = '';
          document.getElementById('password').focus();
        }
      } catch (error) {
        console.error('ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼:', error);
        showError('ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚');
      } finally {
        setLoadingState(false);
      }
    }

    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®åˆ¶å¾¡
    function setLoadingState(loading) {
      isLoading = loading;
      const loginBtn = document.getElementById('login-btn');
      const btnText = loginBtn.querySelector('.btn-text');
      const btnLoading = document.getElementById('btn-loading');
      
      if (loading) {
        loginBtn.disabled = true;
        btnText.style.display = 'none';
        btnLoading.style.display = 'flex';
        loginBtn.classList.add('loading');
      } else {
        loginBtn.disabled = false;
        btnText.style.display = 'block';
        btnLoading.style.display = 'none';
        loginBtn.classList.remove('loading');
      }
    }

    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
    function showError(message) {
      const errorElement = document.getElementById('error-message');
      const errorText = errorElement.querySelector('.error-text');
      
      errorText.textContent = message;
      errorElement.style.display = 'block';
      
      // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åŠ¹æœ
      errorElement.style.opacity = '0';
      errorElement.style.transform = 'translateY(-10px)';
      
      setTimeout(() => {
        errorElement.style.transition = 'all 0.3s ease';
        errorElement.style.opacity = '1';
        errorElement.style.transform = 'translateY(0)';
      }, 10);
    }

    // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®éè¡¨ç¤º
    function hideError() {
      const errorElement = document.getElementById('error-message');
      errorElement.style.display = 'none';
    }

    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã—ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    function showSuccessAndRedirect() {
      const errorElement = document.getElementById('error-message');
      const errorIcon = errorElement.querySelector('.error-icon');
      const errorText = errorElement.querySelector('.error-text');
      
      // æˆåŠŸã‚¹ã‚¿ã‚¤ãƒ«ã«å¤‰æ›´
      errorElement.className = 'success-message';
      errorIcon.textContent = 'âœ…';
      errorText.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã—ãŸã€‚ç®¡ç†ç”»é¢ã«ç§»å‹•ã—ã¾ã™...';
      errorElement.style.display = 'block';
      
      // 1.5ç§’å¾Œã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
      setTimeout(() => {
        window.location.href = 'admin.html';
      }, 1500);
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤º/éè¡¨ç¤ºã®åˆ‡ã‚Šæ›¿ãˆ
    function togglePasswordVisibility() {
      const passwordInput = document.getElementById('password');
      const toggleIcon = document.getElementById('password-toggle-icon');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        toggleIcon.textContent = 'ğŸ™ˆ';
      } else {
        passwordInput.type = 'password';
        toggleIcon.textContent = 'ğŸ‘ï¸';
      }
    }

    // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: ãƒšãƒ¼ã‚¸é›¢è„±æ™‚ã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
    window.addEventListener('beforeunload', function() {
      const passwordField = document.getElementById('password');
      if (passwordField) {
        passwordField.value = '';
      }
    });

    // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
    document.addEventListener('keydown', function(e) {
      // Escape ã‚­ãƒ¼ã§ã‚¨ãƒ©ãƒ¼ã‚’éè¡¨ç¤º
      if (e.key === 'Escape') {
        hideError();
      }
    });
  </script>
</body>
</html> 