<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LocalStorage ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</title>
  <style>
    body { font-family: 'Courier New', monospace; padding: 20px; background: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; }
    .section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .section h2 { color: #333; border-bottom: 2px solid #007acc; padding-bottom: 10px; }
    .key-item { margin: 10px 0; padding: 15px; background: #f8f9fa; border-left: 4px solid #007acc; }
    .key-name { font-weight: bold; color: #d63384; }
    .key-size { color: #6c757d; font-size: 0.9em; }
    .key-content { margin-top: 10px; max-height: 200px; overflow-y: auto; background: #fff; padding: 10px; border-radius: 4px; }
    pre { margin: 0; white-space: pre-wrap; word-break: break-all; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
    .stat-card { background: #e7f3ff; padding: 15px; border-radius: 8px; text-align: center; }
    .stat-number { font-size: 2em; font-weight: bold; color: #007acc; }
    .stat-label { color: #666; margin-top: 5px; }
    .actions { margin: 20px 0; }
    .btn { padding: 10px 20px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .btn:hover { background: #0056b3; }
    .btn.danger { background: #dc3545; }
    .btn.danger:hover { background: #c82333; }
    .article-preview { background: #f8f9fa; padding: 10px; margin: 5px 0; border-radius: 4px; }
    .article-meta { font-size: 0.8em; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” RBS LocalStorage ãƒ‡ãƒãƒƒã‚°ãƒ„ãƒ¼ãƒ«</h1>
    
    <!-- çµ±è¨ˆæƒ…å ± -->
    <div class="section">
      <h2>ğŸ“Š ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çµ±è¨ˆ</h2>
      <div class="stats" id="storage-stats">
        <!-- å‹•çš„ã«ç”Ÿæˆ -->
      </div>
    </div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="section">
      <h2>âš¡ ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h2>
      <div class="actions">
        <button class="btn" onclick="refreshData()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿æ›´æ–°</button>
        <button class="btn" onclick="createTestData()">ğŸ§ª ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ</button>
        <button class="btn" onclick="exportData()">ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
        <button class="btn danger" onclick="clearRbsData()">ğŸ—‘ï¸ RBSãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢</button>
      </div>
    </div>

    <!-- è¨˜äº‹ãƒ‡ãƒ¼ã‚¿è©³ç´° -->
    <div class="section">
      <h2>ğŸ“° è¨˜äº‹ãƒ‡ãƒ¼ã‚¿è©³ç´°</h2>
      <div id="articles-detail">
        <!-- å‹•çš„ã«ç”Ÿæˆ -->
      </div>
    </div>

    <!-- å…¨LocalStorageã‚­ãƒ¼ -->
    <div class="section">
      <h2>ğŸ—‚ï¸ å…¨LocalStorageã‚­ãƒ¼</h2>
      <div id="all-keys">
        <!-- å‹•çš„ã«ç”Ÿæˆ -->
      </div>
    </div>
  </div>

  <script>
    // CONFIGè¨­å®šï¼ˆç°¡æ˜“ç‰ˆï¼‰
    const CONFIG_KEYS = {
      articles: 'rbs_articles',
      instagram: 'rbs_instagram_posts',
      lessons: 'rbs_lessons',
      settings: 'rbs_settings',
      adminSettings: 'rbs_admin_settings'
    };

    // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
    function refreshData() {
      updateStorageStats();
      updateArticlesDetail();
      updateAllKeys();
    }

    // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çµ±è¨ˆæ›´æ–°
    function updateStorageStats() {
      const statsContainer = document.getElementById('storage-stats');
      
      // åŸºæœ¬çµ±è¨ˆ
      const totalKeys = localStorage.length;
      const rbsKeys = getRbsKeys();
      
      // è¨˜äº‹çµ±è¨ˆ
      const articlesData = getStorageData(CONFIG_KEYS.articles);
      const articles = articlesData ? articlesData.data : [];
      const publishedCount = articles.filter(a => a.status === 'published').length;
      const draftCount = articles.filter(a => a.status === 'draft').length;
      
      // Instagramçµ±è¨ˆ
      const instagramData = getStorageData(CONFIG_KEYS.instagram);
      const instagramPosts = instagramData ? instagramData.data : [];
      const activeInstagram = instagramPosts.filter(p => p.status === 'active').length;
      
      statsContainer.innerHTML = `
        <div class="stat-card">
          <div class="stat-number">${totalKeys}</div>
          <div class="stat-label">ç·ã‚­ãƒ¼æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${rbsKeys.length}</div>
          <div class="stat-label">RBSã‚­ãƒ¼æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${articles.length}</div>
          <div class="stat-label">ç·è¨˜äº‹æ•°</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${publishedCount}</div>
          <div class="stat-label">å…¬é–‹è¨˜äº‹</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${draftCount}</div>
          <div class="stat-label">ä¸‹æ›¸ã</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${instagramPosts.length}</div>
          <div class="stat-label">InstagramæŠ•ç¨¿</div>
        </div>
      `;
    }

    // è¨˜äº‹è©³ç´°æ›´æ–°
    function updateArticlesDetail() {
      const container = document.getElementById('articles-detail');
      const articlesData = getStorageData(CONFIG_KEYS.articles);
      
      if (!articlesData || !articlesData.data || articlesData.data.length === 0) {
        container.innerHTML = '<p style="color: #dc3545;">âŒ è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>';
        return;
      }
      
      const articles = articlesData.data;
      const publishedArticles = articles.filter(a => a.status === 'published');
      
      container.innerHTML = `
        <div style="margin-bottom: 20px;">
          <strong>âœ… è¨˜äº‹ãƒ‡ãƒ¼ã‚¿ç™ºè¦‹:</strong> ${articles.length}ä»¶ (å…¬é–‹: ${publishedArticles.length}ä»¶)
        </div>
        
        <h4>ğŸ“‹ æœ€æ–°5ä»¶ã®è¨˜äº‹:</h4>
        ${articles.slice(0, 5).map(article => `
          <div class="article-preview">
            <strong>${article.title || 'ç„¡é¡Œ'}</strong>
            <div class="article-meta">
              ID: ${article.id} | 
              ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: <span style="color: ${article.status === 'published' ? 'green' : 'orange'}">${article.status}</span> | 
              ã‚«ãƒ†ã‚´ãƒª: ${article.category} | 
              ä½œæˆ: ${article.createdAt ? new Date(article.createdAt).toLocaleString('ja-JP') : 'ä¸æ˜'}
            </div>
            <div style="font-size: 0.9em; color: #666; margin-top: 5px;">
              ${(article.summary || article.content || '').substring(0, 100)}...
            </div>
          </div>
        `).join('')}
        
        <details style="margin-top: 20px;">
          <summary style="cursor: pointer; color: #007acc;">ğŸ” ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤º</summary>
          <div class="key-content">
            <pre>${JSON.stringify(articles, null, 2)}</pre>
          </div>
        </details>
      `;
    }

    // å…¨ã‚­ãƒ¼æ›´æ–°
    function updateAllKeys() {
      const container = document.getElementById('all-keys');
      const allKeys = getAllStorageKeys();
      const rbsKeys = allKeys.filter(key => key.startsWith('rbs_'));
      
      container.innerHTML = `
        <h4>ğŸ¯ RBSé–¢é€£ã‚­ãƒ¼ (${rbsKeys.length}ä»¶):</h4>
        ${rbsKeys.map(key => {
          const data = getStorageData(key);
          return `
            <div class="key-item">
              <div class="key-name">${key}</div>
              <div class="key-size">ã‚µã‚¤ã‚º: ${data.size} | ã‚¿ã‚¤ãƒ—: ${data.type}</div>
              <details>
                <summary style="cursor: pointer; color: #007acc;">å†…å®¹ã‚’è¡¨ç¤º</summary>
                <div class="key-content">
                  <pre>${data.preview}</pre>
                </div>
              </details>
            </div>
          `;
        }).join('')}
        
        <h4>ğŸ”§ ãã®ä»–ã®ã‚­ãƒ¼ (${allKeys.length - rbsKeys.length}ä»¶):</h4>
        <div style="font-size: 0.9em; color: #666;">
          ${allKeys.filter(key => !key.startsWith('rbs_')).join(', ')}
        </div>
      `;
    }

    // ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
    function getRbsKeys() {
      const keys = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('rbs_')) {
          keys.push(key);
        }
      }
      return keys;
    }

    function getAllStorageKeys() {
      const keys = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key) keys.push(key);
      }
      return keys.sort();
    }

    function getStorageData(key) {
      try {
        const rawData = localStorage.getItem(key);
        if (!rawData) return null;
        
        const parsed = JSON.parse(rawData);
        return {
          data: parsed,
          size: `${(rawData.length / 1024).toFixed(1)} KB`,
          type: Array.isArray(parsed) ? `Array(${parsed.length})` : typeof parsed,
          preview: JSON.stringify(parsed, null, 2).substring(0, 500) + (rawData.length > 500 ? '...' : '')
        };
      } catch (error) {
        return {
          data: null,
          size: 'ä¸æ˜',
          type: 'ã‚¨ãƒ©ãƒ¼',
          preview: `ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ${error.message}`
        };
      }
    }

    // ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆ
    function createTestData() {
      const testArticles = [
        {
          id: `test-${Date.now()}-1`,
          title: 'ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ†ã‚¹ãƒˆè¨˜äº‹1',
          content: '## ãƒ†ã‚¹ãƒˆè¨˜äº‹1\n\nã“ã‚Œã¯ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ†ã‚¹ãƒˆè¨˜äº‹ã§ã™ã€‚',
          category: 'announcement',
          status: 'published',
          summary: 'ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ†ã‚¹ãƒˆè¨˜äº‹1ã§ã™ã€‚',
          publishedAt: new Date().toISOString(),
          createdAt: new Date().toISOString(),
          featured: false
        },
        {
          id: `test-${Date.now()}-2`,
          title: 'ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ†ã‚¹ãƒˆè¨˜äº‹2',
          content: '## ãƒ†ã‚¹ãƒˆè¨˜äº‹2\n\nã“ã‚Œã‚‚ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ†ã‚¹ãƒˆè¨˜äº‹ã§ã™ã€‚',
          category: 'event',
          status: 'published',
          summary: 'ãƒ‡ãƒãƒƒã‚°ç”¨ã®ãƒ†ã‚¹ãƒˆè¨˜äº‹2ã§ã™ã€‚',
          publishedAt: new Date(Date.now() - 86400000).toISOString(),
          createdAt: new Date(Date.now() - 86400000).toISOString(),
          featured: true
        }
      ];
      
      localStorage.setItem(CONFIG_KEYS.articles, JSON.stringify(testArticles));
      console.log('âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸ:', testArticles);
      
      refreshData();
      alert('âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã—ãŸï¼');
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportData() {
      const allData = {};
      Object.entries(CONFIG_KEYS).forEach(([name, key]) => {
        const data = getStorageData(key);
        if (data) {
          allData[name] = data.data;
        }
      });
      
      const dataStr = JSON.stringify(allData, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `rbs-debug-data-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      
      URL.revokeObjectURL(url);
    }

    // RBSãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
    function clearRbsData() {
      if (!confirm('âš ï¸ RBSé–¢é€£ã®å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
        return;
      }
      
      const rbsKeys = getRbsKeys();
      rbsKeys.forEach(key => localStorage.removeItem(key));
      
      console.log('ğŸ—‘ï¸ å‰Šé™¤ã•ã‚ŒãŸã‚­ãƒ¼:', rbsKeys);
      refreshData();
      alert('ğŸ—‘ï¸ RBSãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸï¼');
    }

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', refreshData);
  </script>
</body>
</html> 